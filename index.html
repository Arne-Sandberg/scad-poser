<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCAD editor created with ANTLR4</title>
  <link rel="stylesheet" type="text/css" href="css/velvet.css">

  <script src="require.js"></script>
  <script src="js/velvet.js"></script>
  <script src="js/StreamSaver.js"></script>
  <script src="js/cytoscape.min.js"></script>
  <script src="https://unpkg.com/dagre@0.7.4/dist/dagre.js"></script>
  <script src="js/lib/cytoscape-dagre.js"></script>
  <script src="js/atn-graph.js"></script>
<script type="application/javascript">
var antlr4 = require('antlr4/index');
var ATNState = require('antlr4/atn/ATNState').ATNState;
  
  function viewStylish(e, tokens, lexer, parser, tree){
    var canvas = document.getElementById('canvasEditor');
    var lines=tokens.tokens[0].source[1].strdata.split("\n");
    canvas.height=100+lines.length*16;
    velvet = new pmc.Velvet(canvas, tokens, lexer, parser, tree);
    velvet.addKeyListener((event) => {
      console.log(event.key);
      const fileStream = streamSaver.createWriteStream('filename.scad')
      const writer = fileStream.getWriter()
      const encoder = new TextEncoder
      let uint8array = encoder.encode(velvet.text)
      
      writer.write(uint8array)
      writer.close()
    });
    var atnGraph = new ATNGraph();
    velvet.addATNListener((rule) => {
      atnGraph.build(rule);
    });

    //autocomplete(document.getElementById("g4Input"), velvet.autoList);
    /*Svar xhr = new XMLHttpRequest(); 
    xhr.open('GET', "/scad/SCADLexer.tokens", true); 
    //xhr.responseType = "blob";
    xhr.onload = function() {
      if (xhr.status >= 200 && xhr.status < 400){
        // Success!
        velvet.populateAvailableTokens(xhr.responseText);
      } else {
        // We reached our target server, but it returned an error

      }
    };
    xhr.send(null);*/
//document.getElementById('canvasEditor').style.display = "none";
//document.getElementById('cursor').style.display = "none";
  }
  
  </script>
</head>
<body>
  <div>
    <div id="info" style="width: 400px; float: left;">
      <input type="file" id="files" name="files[]" multiple />
      <output id="list"></output>
    </div>
  </div>
  <div id="container" width="100%" height="100%" style="clear:both;">
  <div id="plate">
    <canvas id="canvasEditor" width="1200" height="500" tabindex="1"/>
  </div>
    <footer id="foot"></footer>
  </div>

  <script src="js/file-reader-logic.js" type="text/javascript" charset="utf-8"></script>
</body>
</html>